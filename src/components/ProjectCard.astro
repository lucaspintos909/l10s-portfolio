---
import type { CollectionEntry } from "astro:content";
import type { Locale } from "../i18n/index";
import { ui } from "../i18n/ui";
import SkillBadge from "./SkillBadge.astro";
import { Icon } from "astro-icon/components";

interface Props {
    project: CollectionEntry<"projects">;
    lang: Locale;
}

const { project, lang } = Astro.props;
const t = (key: keyof typeof ui["es"]) => ui[lang][key] ?? ui["es"][key];
const { Content } = await project.render();
---

<article
    class="cv-card group relative flex flex-col gap-4 animate-slide-up"
    aria-labelledby={`project-title-${project.id}`}
>
    <!-- Featured badge -->
    {
        project.data.featured && (
            <div class="absolute top-4 right-4">
                <span
                    class="font-mono text-2xs font-medium px-2 py-0.5 rounded-full border"
                    style="color: var(--color-accent); border-color: var(--color-accent); background-color: color-mix(in srgb, var(--color-accent) 8%, transparent);"
                >
                    â˜… {t("projects.featured")}
                </span>
            </div>
        )
    }

    <!-- Title -->
    <h3
        id={`project-title-${project.id}`}
        class="text-sm font-semibold leading-snug pr-20"
    >
        {project.data.title}
    </h3>

    <!-- Description (rendered markdown) -->
    <div class="text-sm flex-1" style="color: var(--color-text-muted);">
        <Content />
    </div>

    <!-- Tech badges -->
    {
        project.data.technologies.length > 0 && (
            <div class="flex flex-wrap gap-1.5">
                {project.data.technologies.map((tech: string) => (
                    <SkillBadge name={tech} />
                ))}
            </div>
        )
    }

    <!-- Links row -->
    <div
        class="flex items-center gap-3 pt-1 border-t"
        style="border-color: var(--color-border);"
    >
        {
            project.data.githubUrl && (
                <a
                    href={project.data.githubUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="cv-link"
                    aria-label={`${t("projects.github")}: ${
                        project.data.title
                    }`}
                >
                    <Icon name="lucide:github" class="h-3.5 w-3.5" />
                    {t("projects.github")}
                </a>
            )
        }
        {
            project.data.demoUrl && (
                <a
                    href={project.data.demoUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="cv-link"
                    aria-label={`${t("projects.demo")}: ${project.data.title}`}
                >
                    <Icon name="lucide:external-link" class="h-3.5 w-3.5" />
                    {t("projects.demo")}
                </a>
            )
        }
    </div>
</article>
